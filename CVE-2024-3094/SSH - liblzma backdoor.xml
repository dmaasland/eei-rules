<?xml version="1.0" encoding="utf-8"?>
<rule>
    <definition>
        <parentprocess>
            <operator type="and">
                <condition component="FileItem" condition="is" property="FileName" value="sshd" />
                <condition component="ProcessInfo" condition="contains" property="CommandLine" value="-D" />
                <condition component="ProcessInfo" condition="contains" property="CommandLine" value="-R" />
            </operator>
        </parentprocess>
        <process>
            <operator type="and">
                <condition component="FileItem" condition="isnot" property="FileName" value="sshd" />
                <condition component="ProcessInfo" condition="starts" property="CommandLine" value="sh -c" />
                <condition component="ProcessInfo" condition="notends" property="CommandLine" value="--lsbsysinit /etc/update-motd.d > /run/motd.dynamic.new" />
            </operator>
        </process>
    </definition>
    <maliciousProcess process="current" />
    <actions>
        <action name="TriggerDetection" />
        <action name="StoreEvent" />
    </actions>
    <description>
        <os>Linux</os>
        <name>SSH Backdoor Activity (liblzma)</name>
        <category>Suspicious process creation and process manipulation</category>
        <explanation>
SSH running sh -c is not normal behaviour
        </explanation>
        <maliciousCauses>SSH backdoor is executing commands - external programs in a new process.</maliciousCauses>
        <benignCauses>A legitimate SSH process is creating a new process.</benignCauses>
        <recommendedActions>If the new process was created by a known and legitimate, add an exclusion to this rule.</recommendedActions>
        <severity>75</severity>
    </description>
</rule>