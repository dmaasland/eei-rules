<?xml version="1.0" encoding="utf-8"?>
<ruleMetadata>
    <isInternal>false</isInternal>
    <guid>9e70afb7-d15a-4d86-9b99-4436615e5f1e</guid>
    <rule>
        <definition>
            <process>
                <operator type="AND">
                    <operator type="AND">
                        <condition component="FileItem" property="Path" condition="starts" value="%SYSTEM%" />
                        <Condition component="FileItem" condition="is" property="FileNameWithoutExtension" value="w3wp" />
                    </operator>
                    <operator type="OR">
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangeOWAAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangeECPAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangeAutodiscoverAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangeRpcProxyFrontEndAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangePowerShellFrontEndAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangeMapiFrontEndAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="contains" value="-ap &quot;MSExchange" />
                    </operator>
                </operator>
            </process>
            <operations>
                <operation type="WriteFile">
                    <operator type="AND">
                        <condition component="FileItem" property="Extension" condition="is" value="aspx" />
                        <operator type="OR">
                            <condition component="FileItem" condition="ends" property="Path" value="\FrontEnd\HttpProxy\ecp\" />
                            <condition component="FileItem" condition="contains" property="Path" value="\FrontEnd\HttpProxy\owa\" />
                            <condition component="FileItem" condition="contains" property="Path" value="\inetpub\wwwroot\" />
                        </operator>
                    </operator>
                </operation>
                <operation type="RenameFile">
                    <operator type="AND">
                        <condition component="FileItem" property="Extension" condition="is" value="aspx" />
                        <operator type="OR">
                            <condition component="FileItem" condition="ends" property="Path" value="\FrontEnd\HttpProxy\ecp\" />
                            <condition component="FileItem" condition="contains" property="Path" value="\FrontEnd\HttpProxy\owa\" />
                            <condition component="FileItem" condition="contains" property="Path" value="\inetpub\wwwroot\" />
                        </operator>
                    </operator>
                </operation>
            </operations>
        </definition>
        <description>
            <name>Microsoft Exchange CVE-2021-26855 (ProxyLogon) exploited. [E1802C]</name>
            <severity>80</severity>
            <explanation>
            This rule looks for signs that SSRF has been succesfully exploited on a Microsoft Exchange server.
        </explanation>
            <maliciousCauses>
            Succesful exploitation of CVE-2021-26855 (ProxyLogon).
        </maliciousCauses>
            <category>
            Exploitation
        </category>
        </description>
    </rule>
</ruleMetadata>
