<?xml version="1.0" encoding="UTF-8"?>
<ruleMetadata>
    <isInternal>false</isInternal>
    <guid>93c03360-fc92-4ac5-acc5-a1cc6382f892</guid>
    <rule>
        <definition>
            <ParentProcess>
                <condition component="FileItem" condition="is" property="FileName" value="svchost.exe" />
            </ParentProcess>
            <process>
                <operator type="AND">
                    <condition component="FileItem" condition="is" property="FileName" value="w3wp.exe" />
                    <!-- IIS worker process-->
                    <operator type="OR">
                        <condition component="FileItem" property="Path" condition="is" value="%SYSTEM%\inetsrv\" />
                        <condition component="FileItem" property="Path" condition="is" value="%WINDIR%\syswow64\inetsrv\" />
                    </operator>
                    <operator type="OR">
                        <condition component="ProcessInfo" property="CommandLine" condition="contains" value="-ap &quot;MSExchangeOWAAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="contains" value="-ap &quot;MSExchangeECPAppPool&quot;" />
                    </operator>
                </operator>
            </process>
            <operations>
                <operation type="HttpRequest">
                    <operator type="AND">
                        <Condition component="Network" condition="starts" property="Url" value="https://" />
                        <condition component="Network" condition="notends" property="Url" value="microsoft.com" />
                        <condition component="Network" condition="notends" property="Url" value="office.net" />
                    </operator>
                </operation>
            </operations>
        </definition>
        <description>
            <name>Outlook Web Access - IIS Worker HTTPS connection [E1802B]</name>
            <severity>65</severity>
            <explanation>This rule looks for signs that SSRF has been succesfully exploited on a Microsoft Exchange server.</explanation>
            <maliciousCauses>Succesful exploitation of CVE-2021-26855 (ProxyLogon).</maliciousCauses>
            <benigncauses>The w3wp process can reach out to certain Office URL's.</benigncauses>
            <category>Exploitation</category>
        </description>
    </rule>
</ruleMetadata>