<?xml version="1.0" encoding="UTF-8"?>
<ruleMetadata>
    <isInternal>false</isInternal>
    <guid>9507b7dd-2c67-4fa5-a872-1bb873cda88e</guid>
    <rule>
        <definition>
            <ParentProcess>
                <condition component="FileItem" condition="is" property="FileName" value="svchost.exe" />
            </ParentProcess>
            <Process>
                <operator type="AND">
                    <condition component="FileItem" condition="is" property="FileName" value="w3wp.exe" />
                    <!-- IIS worker process-->
                    <operator type="OR">
                        <condition component="FileItem" property="Path" condition="is" value="%SYSTEM%\inetsrv\" />
                        <condition component="FileItem" property="Path" condition="is" value="%WINDIR%\syswow64\inetsrv\" />
                    </operator>
                    <operator type="OR">
                        <condition component="ProcessInfo" property="CommandLine" condition="contains" value="-ap &quot;MSExchangeECPAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="contains" value="-ap &quot;MSExchangeAutodiscoverAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="contains" value="-ap &quot;MSExchangeMapiFrontEndAppPool&quot;" />
                    </operator>
                </operator>
            </Process>
            <operations>
                <operation type="TcpIpConnect">
                    <operator type="AND">
                        <condition component="Network" condition="is" property="port" value="444" />
                        <condition component="Network" condition="is" property="IpAddressV6" value="fe80::/10" />
                    </operator>
                </operation>
            </operations>
        </definition>
        <description>
            <name>Outlook Web Access - Local IPv6 connection to port 444 [E1802A]</name>
            <severity>70</severity>
            <explanation>This rule looks for signs that SSRF has been succesfully exploited on a Microsoft Exchange server.</explanation>
            <maliciousCauses>Succesful exploitation of CVE-2021-26855 (ProxyLogon).</maliciousCauses>
            <category>Exploitation</category>
        </description>
    </rule>
</ruleMetadata>