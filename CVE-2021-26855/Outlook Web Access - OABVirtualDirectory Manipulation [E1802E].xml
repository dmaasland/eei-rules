<?xml version="1.0" encoding="UTF-8"?>
<ruleMetadata>
    <isInternal>false</isInternal>
    <guid>85965fdb-aa40-4786-bad8-6cecc139e584</guid>
    <rule>
        <definition>
            <ParentProcess>
                <condition component="FileItem" condition="is" property="FileName" value="svchost.exe" />
            </ParentProcess>
            <process>
                <operator type="AND">
                    <condition component="FileItem" condition="is" property="FileName" value="w3wp.exe" />
                    <!-- IIS worker process-->
                    <operator type="OR">
                        <condition component="FileItem" property="Path" condition="is" value="%SYSTEM%\inetsrv\" />
                        <condition component="FileItem" property="Path" condition="is" value="%WINDIR%\syswow64\inetsrv\" />
                    </operator>
                    <condition component="ProcessInfo" property="CommandLine" condition="contains" value="-ap &quot;MSExchangeECPAppPool&quot;" />
                </operator>
            </process>
            <operations>
                <operation type="Scripts">
                    <operator type="AND">
                        <condition component="Scripts" property="script" condition="contains" value="[Microsoft.Exchange.Data.Fqdn]" />
                        <operator type="OR">
                            <condition component="Scripts" property="script" condition="contains" value=".ForwardHelpTargetName Get-OabVirtualDirectory" />
                            <condition component="Scripts" property="script" condition="contains" value=".ForwardHelpTargetName Set-OabVirtualDirectory" />
                            <condition component="Scripts" property="script" condition="contains" value=".ForwardHelpTargetName Remove-OabVirtualDirectory" />
                        </operator>
                    </operator>
                </operation>
            </operations>
        </definition>
        <description>
            <name>Outlook Web Access - OABVirtualDirectory Manipulation [E1802E]</name>
            <severity>70</severity>
            <explanation>This rule looks for signs that SSRF has been succesfully exploited on a Microsoft Exchange server.</explanation>
            <maliciousCauses>Succesful exploitation of CVE-2021-26855 (ProxyLogon).</maliciousCauses>
            <benigncauses>An administrator updating the OAB Virtual Directory.</benigncauses>
            <category>Exploitation</category>
        </description>
    </rule>
</ruleMetadata>