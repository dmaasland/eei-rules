<?xml version="1.0" encoding="utf-8"?>
<ruleMetadata>
    <isInternal>false</isInternal>
    <guid>9507b7dd-2c67-4fa5-a872-1bb873cda88e</guid>
    <rule>
        <definition>
            <process>
                <operator type="AND">
                    <operator type="AND">
                        <condition component="FileItem" property="Path" condition="starts" value="%SYSTEM%" />
                        <Condition component="FileItem" condition="is" property="FileNameWithoutExtension" value="w3wp" />
                    </operator>
                    <operator type="OR">
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangeOWAAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangeECPAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangeAutodiscoverAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangeRpcProxyFrontEndAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangePowerShellFrontEndAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="starts" value="-ap &quot;MSExchangeMapiFrontEndAppPool&quot;" />
                        <condition component="ProcessInfo" property="CommandLine" condition="contains" value="-ap &quot;MSExchange" />
                    </operator>
                </operator>
            </process>
            <operations>
                <operation type="TcpIpConnect">
                    <operator type="AND">
                        <condition component="Network" condition="is" property="port" value="444" />
                        <operator type="OR">
                            <condition component="Network" condition="is" property="IpAddressV4" value="127.0.0.0/8" />
                            <condition component="Network" condition="is" property="IpAddressV4" value="10.0.0.0/8" />
                            <condition component="Network" condition="is" property="IpAddressV4" value="172.16.0.0/12" />
                            <condition component="Network" condition="is" property="IpAddressV4" value="192.168.0.0/16" />
                            <condition component="Network" condition="is" property="IpAddressV6" value="fe80::/10" />
                        </operator>
                    </operator>
                </operation>
            </operations>
        </definition>
        <description>
            <name>Microsoft Exchange CVE-2021-26855 (ProxyLogon) exploited. [E1802A]</name>
            <severity>90</severity>
            <explanation>
            This rule looks for signs that SSRF has been succesfully exploited on a Microsoft Exchange server.
        </explanation>
            <maliciousCauses>
            Succesful exploitation of CVE-2021-26855 (ProxyLogon).
        </maliciousCauses>
            <category>
            Exploitation
        </category>
        </description>
    </rule>
</ruleMetadata>
