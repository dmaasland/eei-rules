<?xml version="1.0" encoding="utf-8"?>
<rule>
    <definition>
        <process>
            <operator type="AND">
                <condition component="FileItem" property="Path" condition="is" value="%SYSTEM%\" />
                <condition component="FileItem" property="FileNameWithoutExtension" condition="is" value="spoolsv" />
                <condition component="ProcessInfo" property="ProcessOwner" condition="is" value="nt authority\system" />
            </operator>
        </process>
        <operations>
            <operation type="ModuleDrop">
                <operator type="AND">
                    <condition component="FileItem" property="Path" condition="starts" value="%SYSTEM%\spool\drivers\" />
                    <condition component="FileItem" property="Extension" condition="is" value="dll" />
                    <operator type="OR">
                        <condition component="LiveGrid" condition="less" property="Popularity" value="100" />
                        <condition component="LiveGrid" condition="less" property="Reputation" value="4" />
                    </operator>
                </operator>
            </operation>
        </operations>
    </definition>
    <description>
        <name>PrintNightmare - Printer Spooler dropped .dll file [K1989A]</name>
        <explanation>
            This rule detects the potential exploitation of CVE-2021-1675 (PrintNightmare). Specifically, spoolsv.exe dropping a .dll file with a low reputation into the spool drivers folder.
        </explanation>
        <maliciousCauses>
            An attacker may be attempting to gain access to the system by exploiting CVE-2021-1675.
        </maliciousCauses>
        <benignCauses>
            No benign causes have been found yet.
        </benignCauses>
        <recommendedActions>1. Verify which DLL caused the detection and its attributes. Is it part of an intentionally installed program?
2. Verify the source of the DLL library. If applicable, compare it to the official distribution package.
3. Inspect the behavior of the program that loaded the library. Was it used elsewhere in your environment?
4. Scan the DLL library with an updated Antivirus program.
5. If the DLL is suspicious, submit it for further analysis.</recommendedActions>
        <category>
            Exploitation
        </category>
        <severity>60</severity>
    </description>
</rule>