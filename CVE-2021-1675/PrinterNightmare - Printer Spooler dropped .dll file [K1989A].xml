<?xml version="1.0" encoding="utf-8"?>
<rule>
    <definition>
        <process>
            <operator type="AND">
                <condition component="FileItem" property="FileName" condition="is" value="spoolsv.exe" />
                <condition component="FileItem" property="Path" condition="starts" value="%SYSTEM%" />
                <condition component="ProcessInfo" property="ProcessOwner" condition="is" value="nt authority\system" />
            </operator>
        </process>
        <operations>
            <operation type="WriteFile">
                <operator type="AND">
                    <condition component="LiveGrid" property="Reputation" condition="less" value="5" />
                    <condition component="FileItem" property="Path" condition="starts" value="%SYSTEM%\spool\drivers\" />
                    <condition component="FileItem" property="Extension" condition="starts" value="dll" />
                </operator>
            </operation>
            <operation type="LoadDLL">
                <operator type="AND">
                    <condition component="LiveGrid" property="Reputation" condition="less" value="5" />
                    <condition component="FileItem" property="Path" condition="starts" value="%SYSTEM%\spool\drivers\" />
                    <condition component="FileItem" property="Extension" condition="starts" value="dll" />
                </operator>
            </operation>
        </operations>
    </definition>
    <description>
        <name>PrinterNightmare - Printer Spooler dropped .dll file [K1989A]</name>
        <explanation>
            This rule detects the potential exploitation of CVE-2021-1675 (PrinterNightmare). Specifically, spoolsv.exe dropping a .dll file with a low reputation into the spool drivers folder.
        </explanation>
        <maliciousCauses>
            An attacker may be attempting to gain access to the system by exploiting CVE-2021-1675
        </maliciousCauses>
        <benignCauses>
            No benign causes have been found yet.
        </benignCauses>
        <category>
            Execution
        </category>
        <severity>Threat</severity>
    </description>
</rule>