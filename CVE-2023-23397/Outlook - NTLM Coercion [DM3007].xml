<?xml version='1.0' encoding='UTF-8'?>
<rule>
  <description>
    <name>Possible exploitation of CVE-2023-23397 (Outlook NTLM coercion) [DM3007]</name>
    <category>Vulnerabilities</category>
    <os>Windows</os>
    <severity>75</severity>
    <explanation>CVE-2023-23397 is a vulnerability in Microsoft Outlook that allows an attacker to force 
authentication to a remote server, also known as NTLM coercion. Succesful exploitation only requires a vulnerable 
version of outlook and an incoming email. The email does not have to be opened for the exploit to trigger.</explanation>
    <benignCauses>Unknown</benignCauses>
    <maliciousCauses>An attacker attemtping to exploit CVE-2023-23397</maliciousCauses>
    <recommendedActions>Check if the connection was succesful and reset the password for the user that was targeted.
Also run the Microsoft script to see if more users were affected:
https://microsoft.github.io/CSS-Exchange/Security/CVE-2023-23397/</recommendedActions>
  </description>
  <definition>
    <process>
      <condition component="Module" condition="is" property="OriginalFileName" value="OUTLOOK.EXE"/>
    </process>
    <operations>
      <operation type="TcpIpProtocolIdentified">
        <operator type="AND">
          <condition component="Network" condition="starts" property="Protocol" value="SMB"/>
          <operator type="NOT">
            <operator type="OR">
              <operator type="OR">
                <condition component="Network" condition="is" property="IpAddressV4" value="10.0.0.0/8"/>
                <condition component="Network" condition="is" property="IpAddressV4" value="172.16.0.0/12"/>
                <condition component="Network" condition="is" property="IpAddressV4" value="192.168.0.0/16"/>
                <condition component="Network" condition="is" property="IpAddressV4" value="127.0.0.0/8"/>
                <condition component="Network" condition="is" property="IpAddressV4" value="169.254.0.0/16"/>
              </operator>
              <operator type="OR">
                <condition component="Network" condition="is" property="IpAddressV6" value="fc00::/7"/>
                <condition component="Network" condition="is" property="IpAddressV6" value="::1/128"/>
                <condition component="Network" condition="is" property="IpAddressV6" value="fe80::/10"/>
              </operator>
            </operator>
          </operator>
        </operator>
      </operation>
    </operations>
  </definition>
  <maliciousTarget name="none"/>
  <actions>
    <action name="TriggerDetection"/>
    <action name="StoreEvent"/>
  </actions>
</rule>